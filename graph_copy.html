<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Assignment 1</title>
	<script type="text/javascript" src="./d3.js"></script>
	<link rel="stylesheet" href="styles.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
	<div id="container" class="container">

		<h2>Part 1: DAOST Chapter 2 Questions</h2>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				Explain in your own words the point of the jitter plot.
			</div>
			<div>
				A jitter plot is a special scatter plot. Jittering stand for a specific procedure where the aim is to prevent overlapping
				in statistical graphics. Overlapping can occur when the data is not continuous and only specific values can be interpreted
				or when a continuous measurement is rounded to the nearest value. Jittering is achieved by adding a random noise to the
				data and thus shifting them a bit away from their original locations. To improve the visual experience it is recommended
				to represent datapoints with an empty circle instead of a dot, thus helping the eye to distinguish the ones who are close
				to each other.
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				Explain in your own words the point of figure 2-3. (I'm going to skip saying "in your own words" going forward, but I hope
				you get the point; I expect all answers to be in your own words).
			</div>
			<div>
				Plotting data with histograms results in information loss, due to the binning process applied in histogram creation. This
				information loss is displayed on the figure mentioned in the question. The plots are representing the same dataset, the
				only difference is the number of bins used in the histogram. Choosing the proper binning has a huge effect on the resulting
				diagram. It is recommended to try a few binning solutions before settling for the final one.
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				The author of DAOST (Philipp Janert) likes KDEs (and think they're better than histograms). And I don't. I didn't give a
				detailed explanation in the video, but now that works to my advantage. I'll ask you guys to think about this and thereby
				create an excellent exercise: When can KDEs be misleading?
			</div>
			<div>
				KDE stands for Kernel Density Estimation, an alternative solution to histograms. The problems one can face when using histograms
				are that they are not smooth, they depend on end points of bins and they depend on the width of bins. The first two problems
				can be solved by using KDEs. Rather than fixing the end points of the blocks we center each of the data blocks at each
				data point. With a very fine "blocking" procedure, and by placing blocks on top of each other when there is an overlap
				we can obtain the density estimate. But at this step our graph is still "blocky". To solve this we should use a smooth
				Gaussian curve instead of the block when there is a datapoint. Selecting the proper bandwidth of the Gaussian curve is
				a very important step, with a small standard deviation the final graph we obtain will be "undersmoothed", but applying
				a big standard deviation will result in an "oversmoothed" graph. As a drawback of KDE it is important to mention that
				it is hard to see where the actual data is. In some cases it is better to see the data position directly.
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				I've discussed some strengths of the CDF - there are also weaknesses. Janert writes "[CDFs] have less intuitive appeal than
				histograms of KDEs". What does he mean by that?
			</div>
			<div>
				Cumulative Distribution Function is more or less the integral of the histogram. This graph at point 'x' tells us what fraction
				of data can be fount to the 'left' of x. This type of diagram has a lot of essential advantages. Reading of important
				key values such as minimum, median, quantil or maximum can be easily done directly from the plot. Detection of outlier
				data can be also done from this plot. Besides these advantages mentioned previously, this type of data visualization
				has drawbacks too. The problem is that the eye is much better at judging distances than areas and CDF uses aereas to
				represent datapoints.
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				What is a
				<i>Quantile plot</i>? What is it good for?
			</div>
			<div>
				A quantile plot is obtained from a CDF plot by switching the x-y axes. The information contained in this graph is the same
				as it was in the CDF but the main reason behind this type of graphs is the better data representation. For example if
				we have data about a country's population, and lets say we want to investigate the wealthyness of households, and the
				dispersion of it, CDF is a good way to go. With the help of this graph we can easily answer questions like "What yearly
				income corresponds to the 20th percentile of the country's population?".
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				How is a
				<i>Probability plot</i> defined? What is it useful for? Have you ever seen one before?
			</div>
			<div>
				The probability plot is a graphical technique for assessing whether or not a data set follows a given distribution such as
				the normal distribution. The data are plotted against a hypothetical distribution in such a way that the points should
				form approximately a straight line. Distances from this strait line corresponds to departures from the specified distribution.
				The slope of the line is σ (standard deviation of normal distribution) and the zero intercept is μ (mean of the distribution).
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				One of the reasons I like DAOST is that Janert is so suspicious of mean, median, and related summary statistics. Explain
				why one has to be careful when using those - and why visualization of the full data is always better.
			</div>
			<div>
				These summary statistics apply only under certain assumptions and are misleading or even can be wrong if those assumptions
				are not met. Mean, median, and other related summary statistics are only valid when the distributions has a single, central
				peak, on other words, the distribution is unimodal. If this basic assumption is not fulfilled, then conclusions based
				on simple summary statistics will be wrong. Even worse, nothing will tip you off that they are wrong: the numbers will
				look quite reasonable. For example an outstanding data which may result from an error in the data registration can easily
				ruin the average. Let's take an example, a group in preschool where there are 10 child with 1 year and 1 who's 5 years
				old. Describing this dataset with summary statistic can result in uninterpretable data.
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				I love box plots. When are box plots most useful?
			</div>
			<div>
				The box plot (or whiskers diagram) is a standardized way of displaying the distribution of data based on the five summary
				statistics parameter mentioned before: minimum, first quartile, median, third quartile, and maximum. Box plots provide
				an easy way to work with a huge data and to determine outliers in data. It is particularly useful for quickly summarizing
				and comparing different sets of results from different experiments.
			</div>
		</div>

		<div class="card">
			<div class="question">
				<i class="material-icons">help</i>
				The book doesn't mention
				<a href="https://en.wikipedia.org/wiki/Violin_plot" target="_blank">violin</a> plots. Are those better or worse than box plots? Why?
			</div>
			<div>
				At a first glance, according to our personal opinion they are harder to interpret compared to a simple box plot. The plot
				itself is similar to a box plot, but instead of using straight lines in each side of the boxes, it uses a rotated kerner
				density plot. Thus they're providing more information about the dataset, especially about the probability density.
			</div>
		</div>

		<h2>Part 2: DAOST Chapter 3 Questions</h2>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        Looking at Fig 3-1, Janert writes "the data itself shows clearly that the amount of random noise in the data is small". What
        do you think his argument is?
      </div>
      <div>
        The noise does seem to be small since the data creates a coherent line with only small subharmonic components.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        Can you think of a real-world example of a multivariate relationship like the one in Fig 3-3 (lower right panel)?
      </div>
      <div>
        If we plot the average consumption of cars against their time of creation, then we will se a multivariate
        relationship, since diesel cars will always have an offset to gas cars, thus we will see two coherent lines
        on the diagram.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        What are the two methods Janert mentions for smoothing noisy data? Can you think of other ones?
      </div>
      <div>
        The two methods are based on inserting a spline on the data set: weighted spline and LOESS/LOWESS spline. The
        noise can also be reduced by averaging the data and setting thresholds or place high frequency filters on it.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        What are residuals? Why is it a good idea to plot the residuals of your fit?
      </div>
      <div>
        Residuals are data points that don't fit perfectly to the smoothed trend. It's a good idea to check them on a
        plot because if there is a trend in the residuals, then the model is inaccurate. The residuals should average
        around 0 ideally.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        Explain in your own words the point of the smooth tube in figure 3-7.
      </div>
      <div>
        Two 'threshold' smoothed lines are created, and the majority of data points are expected to be between the
        two lines - these are the dashed lines. The continuous line is achieved by generating a smoothed line, and
        then taking the trend of the residuals into consideration iteratively, until there will be no trend in the
        residuals.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        What kind of relationships will a semi-log plot help you discover?
      </div>
      <div>
        It helps detecting exponentiality in the data set, and it also displays relative changes in the data set that
        are
        often more useful then absolute changes.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        What kind of functions will log-log plots help you see?
      </div>
      <div>
        Functions with power law.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        What the h#ll is banking and what element from our visual system does it use to help us see patterns? What are potential
        problems with banking?
      </div>
      <div>
        Banking is basically adjusting the aspect ratio of the entire plot so the changes are around 45 degrees in
        angle, so the changes in data will be much more comprehensible to the human eye. The problem comes when you have
        to "zoom out" so much to reach this angle that the magnitude of the change becomes almost unreadable - in
        this case the whole plot should be modified with a more suitable approach.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        I think figure 3-14 makes an important point about linear fits that is rarely made. What is it?
      </div>
      <div>
        The point is that linear fits are not to be used to give a general description of the data, but rather to be
        able to make a quick prediction of the outcome of a controlled input.
      </div>
    </div>

    <div class="card">
      <div class="question">
        <i class="material-icons">help</i>
        Summarize the discussion of Graphical Analysis and Presentation Graphics on pp. 68-69 in your own words.
      </div>
      <div>
        The main point of the section is that there is a significant difference between graphical analysis (which is
        used to discover more information about the data) and presentation graphics (that is used to highlight and
        communicate the information that we already know about the data set). GA is for experimenting, PG is all
        about effective and clear communication.
      </div>
    </div>

		<h2>Part 3: Viz 1</h2>

		<div class="card">
			<p>This is a reproduction of
				<a href="http://iquantny.tumblr.com/post/129373499164/this-is-quantifiably-the-best-month-to-go-to-the">this site</a>.</p>
			<a href="http://iquantny.tumblr.com/post/129373499164/this-is-quantifiably-the-best-month-to-go-to-the" class="h2 title">This is Quantifiably the Best Month to go to the Farmers Market</a>
			<p>As part of a homework assignment, I ask my students at Pratt to go out and chart something of interest to them, and
				<a href="https://www.linkedin.com/in/kvsavarese/">Katherine Savarese</a> came back with a simple chart about farmers markets that I loved- it inspired this post.</p>
			<p>You probably know that farmers markets are a staple across
				<a href="http://www.grownyc.org/files/gmkt/map.pdf">all five boroughs</a> of New York City, but September happens to be a very special month. Why is that? Well, it turns
				out September is the month with the most unique types of fresh produce- forty three to be exact.</p>
			<p>To show the current offerings, we charted how many types of fruits and vegetables are available by month, and showed if
				they were fresh or from storage.</p>
			<div id="part3_chart" class="card">
				<table class="chart3_table">
					<tr>
						<td id="fruit_h" class="fruit chart-input"><i class="material-icons chart3_selector1">brightness_1</i>Fruit Harvest</td>
						<td id="fruit_s" class="fruit chart-input"><i class="material-icons chart3_selector2">brightness_1</i>Fruit Storage</td>
					</tr>
					<tr>
						<td id="veggie_h" class="fruit chart-input"><i class="material-icons chart3_selector3">brightness_1</i>Veggie Harvest</td>
						<td id="veggie_s" class="fruit chart-input"><i class="material-icons chart3_selector4">brightness_1</i>Veggie Storage</td>
					</tr>
				</table>
			</div>

			<script type="text/javascript">

				var chartDiv = document.getElementById("part3_chart");
				//Create SVG element
				var svg = d3.select(chartDiv).append("svg");

				function redraw() {
					//Width and height
					var w = chartDiv.clientWidth;
					var h = 300;
					var padding = 30;
					var selected_category = 0;
					var color = "#3F51B5";

					var dataset = [
						{ category: 0, month: "Jan", count: 0 },
						{ category: 0, month: "Feb", count: 0 },
						{ category: 0, month: "Mar", count: 0 },
						{ category: 0, month: "Apr", count: 0 },
						{ category: 0, month: "May", count: 0 },
						{ category: 0, month: "Jun", count: 1 },
						{ category: 0, month: "Jul", count: 7 },
						{ category: 0, month: "Aug", count: 8 },
						{ category: 0, month: "Sep", count: 10 },
						{ category: 0, month: "Oct", count: 5 },
						{ category: 0, month: "Nov", count: 0 },
						{ category: 0, month: "Dec", count: 0 },
						{ category: 1, month: "Jan", count: 0 },
						{ category: 1, month: "Feb", count: 2 },
						{ category: 1, month: "Mar", count: 2 },
						{ category: 1, month: "Apr", count: 1 },
						{ category: 1, month: "May", count: 1 },
						{ category: 1, month: "Jun", count: 1 },
						{ category: 1, month: "Jul", count: 1 },
						{ category: 1, month: "Aug", count: 0 },
						{ category: 1, month: "Sep", count: 0 },
						{ category: 1, month: "Oct", count: 0 },
						{ category: 1, month: "Nov", count: 2 },
						{ category: 1, month: "Dec", count: 2 },
						{ category: 2, month: "Jan", count: 0 },
						{ category: 2, month: "Feb", count: 0 },
						{ category: 2, month: "Mar", count: 0 },
						{ category: 2, month: "Apr", count: 2 },
						{ category: 2, month: "May", count: 11 },
						{ category: 2, month: "Jun", count: 16 },
						{ category: 2, month: "Jul", count: 23 },
						{ category: 2, month: "Aug", count: 28 },
						{ category: 2, month: "Sep", count: 33 },
						{ category: 2, month: "Oct", count: 31 },
						{ category: 2, month: "Nov", count: 11 },
						{ category: 2, month: "Dec", count: 3 },
						{ category: 3, month: "Jan", count: 9 },
						{ category: 3, month: "Feb", count: 9 },
						{ category: 3, month: "Mar", count: 6 },
						{ category: 3, month: "Apr", count: 3 },
						{ category: 3, month: "May", count: 3 },
						{ category: 3, month: "Jun", count: 3 },
						{ category: 3, month: "Jul", count: 2 },
						{ category: 3, month: "Aug", count: 1 },
						{ category: 3, month: "Sep", count: 0 },
						{ category: 3, month: "Oct", count: 0 },
						{ category: 3, month: "Nov", count: 6 },
						{ category: 3, month: "Dec", count: 8 }];

					//Calculate the data subset
					var data = dataset.filter(d => d.category === selected_category);

					//Create scale functions
					var xScale = d3.scaleBand()
						.domain(["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"])
						.rangeRound([padding, w - padding * 2])
						.paddingInner(0.05);

					var yScale = d3.scaleLinear()
						.domain([0, d3.max(data, function (d) { return d.count; })])
						.range([h - padding, padding]);

					//Define X axis
					var xAxis = d3.axisBottom()
						.scale(xScale)
						.ticks(5);

					//Define Y axis
					var yAxis = d3.axisLeft()
						.scale(yScale)
						.ticks(5);

					svg.attr("width", w)
						.attr("height", h);

					//Create bars
					svg.selectAll("rect")
						.data(data)
						.enter()
						.append("rect")
						.attr("x", function (d, i) {
							return xScale(d.month);
						})
						.attr("y", function (d) {
							return yScale(d.count);
						})
						.attr("width", xScale.bandwidth())
						.attr("height", function (d) {
							return h - yScale(d.count) - padding;
						})
						.attr("fill", color);

					//Create labels
					svg.selectAll("text")
						.data(data)
						.enter()
						.append("text")
						.text(function (d) {
							return d.count;
						})
						.attr("text-anchor", "middle")
						.attr("x", function (d, i) {
							return xScale(d.month) + xScale.bandwidth() / 2;
						})
						.attr("y", function (d) {
							return yScale(d.count) + 14;
						})
						.attr("font-family", "sans-serif")
						.attr("font-size", "11px")
						.attr("fill", "white");

					//Create X axis
					svg.append("g")
						.attr("class", "x axis")
						.attr("transform", "translate(0," + (h - padding) + ")")
						.call(xAxis);

					//Create Y axis
					svg.append("g")
						.attr("class", "y axis")
						.attr("transform", "translate(" + padding + ",0)")
						.call(yAxis);

					// now add titles to the axes
					svg.append("text")
						.attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
						.attr("transform", "translate(" + (padding / 3) + "," + (h / 2) + ")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
						.text("# of products");

					svg.append("text")
						.attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
						.attr("transform", "translate(" + (w / 2) + "," + (h) + ")")  // centre below axis
						.text("Month");

					// now add titles to the graph
					svg.append("text")
						.attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
						.attr("transform", "translate(" + (w / 2) + "," + (padding / 2) + ")")  // text is drawn off the screen top left, move down and out and rotate
						.text("NYC Green Markets - Unique Produce Types");

					//On click, update with new data			
					d3.selectAll(".fruit.chart-input")
						.on("click", function () {
							//See which p was clicked
							var paragraphID = d3.select(this).attr("id");
							switch (paragraphID) {
								case "fruit_h":
									selected_category = 0;
									color = "#3F51B5";
									break;
								case "fruit_s":
									selected_category = 1;
									color = "#F44336";
									break;
								case "veggie_h":
									selected_category = 2;
									color = "#E91E63";
									break;
								case "veggie_s":
									selected_category = 3;
									color = "#2196F3";
									break;
								default:
									selected_category = 0;
							}

							data = dataset.filter(d => d.category === selected_category);

							//Update scale domains
							//xScale.domain(d3.range(data.length));
							yScale.domain([0, d3.max(data, function (d) { return d.count; })]);

							//Update all circles
							svg.selectAll("rect")
								.data(data)
								.transition()
								.duration(1000)
								.attr("x", function (d) {
									return xScale(d.month);
								})
								.attr("y", function (d) {
									return yScale(d.count);
								})
								.attr("width", xScale.bandwidth())
								.attr("height", function (d) {
									return h - yScale(d.count) - padding;
								})
								.attr("fill", color);

							//Update all labels
							svg.selectAll("text")
								.data(data)
								.transition()
								.duration(1000)
								.text(function (d) {
									return d.count;
								})
								.attr("x", function (d) {
									return xScale(d.month) + xScale.bandwidth() / 2;
								})
								.attr("y", function (d) {
									return yScale(d.count) + 14;
								});

							//Update X axis
							svg.select(".x.axis")
								.transition()
								.duration(1000)
								.call(xAxis);

							//Update Y axis
							svg.select(".y.axis")
								.transition()
								.duration(1000)
								.call(yAxis);

						});
				};

				redraw();
				//window.addEventListener("resize", redraw);

			</script>

			<p>If you miss the month of September, you might be behind the fruit curve, but there are plenty more months of vegetables
				left. The chart shows that fresh vegetables are available 9 out of 12 months, but fruit is only available 5 out of 12.
				Now if only we could quantify how delicious the produce is…</p>
			<p>—–</p>
			<p>Data from:&nbsp;
				<a href="http://www.grownyc.org/greenmarket/whatsavailable">http://www.grownyc.org/greenmarket/whatsavailable</a>
			</p>
		</div>

		<h2>Part 4: Viz 2</h2>
		<div class="card">
			<p>This is a reproduction of chart 3-5 from 
				<a href="https://www.dropbox.com/s/dgdmmaywqkk0jzq/DAOST_chapter3.pdf?dl=0">DAOST</a>.</p>
			<div id="part4_chart" class="card">
				<table class="chart4_table">
					<tr>
						<td id="women" class="run chart-input"><i class="material-icons chart3_selector2">brightness_1</i>Only women</td>
						<td id="men" class="run chart-input"><i class="material-icons chart3_selector1">brightness_1</i>Only men</td>
					</tr>
					<tr>
						<td id="both" class="run chart-input"><i class="material-icons chart3_selector3">brightness_1</i>Both</td>
					</tr>
				</table>
			</div>
			
			<script type="text/javascript">

				var chartDiv2 = document.getElementById("part4_chart");
				var w = chartDiv2.clientWidth;
				var h = 300;
				var padding = 30;

				//Create SVG element
				var svg2 = d3.select(chartDiv2)
					.append("svg")
					.attr('width', w)
					.attr('height', h);

				var rowConverter = ({ year, name, nat, time, sex }) => ({ year: parseInt(year), time: parseInt(time), sex, name, nat });
				let dataset, xScale, yScale, xAxis, yAxis;

				//Load in data
				d3.csv("data_formatted.csv", rowConverter, function(data) {
					dataset = data;


						// Create scale functions
					xScale = d3.scaleLinear()
						.domain([
							d3.min(dataset, d => d.year),
							d3.max(dataset, d => d.year)
						])
						.rangeRound([padding, w - padding * 2])

					yScale = d3.scaleLinear()
						.domain([
							d3.min(dataset, d => d.time),
							d3.max(dataset, d => d.time)
						])
						.range([h - padding, padding]);

					xAxis = d3.axisBottom().scale(xScale).ticks(5);
					yAxis = d3.axisLeft().scale(yScale).ticks(5);

					svg2.append("clipPath") //Make a new clipPath
						.attr("id", "chart-area") //Assign an ID
						.append("rect") //Within the clipPath, create a new rect
						.attr("x", padding) //Set rect's position and size…
						.attr("y", padding)
						.attr("width", w - padding * 3)
						.attr("height", h - padding * 2);

					// ADDING WOMEN
					svg2.append("g") 					//Create new g
						.attr("id", "women-circles")  //Assign ID of 'circles'
						.attr("clip-path", "url(#chart-area)")
						.selectAll("circle")
						.data(dataset.filter(d => d.sex === 'women'))
						.enter()
						.append("circle")
						.attr("cx", function(d) {
								return xScale(d.year);
						})
						.attr("cy", function(d) {
								return yScale(d.time);
						})
						.attr("r", 2)
						.attr("fill", "rgba(0, 0, 0, 0)")
						.attr("stroke", "red")
						.attr("stroke-width", "0.5")
						.append("title")
						.text(d => `Time: ${d.time}, Year: ${d.year}`);

					
					// adding women trendline
					var women_trend_data = [[1966,179.11,2017,131.4]];
		
					var women_trendline = svg2.selectAll(".trendline.women")
						.data(women_trend_data);
						
					women_trendline.enter()
						.append("line")
						.attr("class", "trendline women")
						.attr("x1", function(d) { return xScale(d[0]); })
						.attr("y1", function(d) { return yScale(d[1]); })
						.attr("x2", function(d) { return xScale(d[2]); })
						.attr("y2", function(d) { return yScale(d[3]); })
						.attr("stroke", "black")
						.attr("stroke-width", 1);

					// Define women line generator
					var line = d3.line()
						.x(function(d) { return xScale(d.year); })
						.y(function(d) { return yScale(d.time); });
					
					svg2.append("path")
						.datum(dataset.filter(d => d.sex === 'women'))
						.attr("class", "line women")
						.attr("d", line);
					
					// ADDING MEN
					svg2.append("g") 					//Create new g
						.attr("id", "men-circles")  //Assign ID of 'circles'
						.attr("clip-path", "url(#chart-area)")
						.selectAll("rect")
						.data(dataset.filter(d => d.sex === 'men'))
						.enter()
						.append("rect")
						.attr("x", function(d) {
								return xScale(d.year) - 2;
						})
						.attr("y", function(d) {
								return yScale(d.time) - 2;
						})
						.attr("width", 4)
						.attr("height", 4)
						.attr("fill", "rgba(0, 0, 0, 0)")
						.attr("stroke", "blue")
						.attr("stroke-width", "0.5")
						.append("title")
						.text(d => `Time: ${d.time}, Year: ${d.year}`);

					// Adding men trendline
					var men_trend_data = [[1897,159.15,2017,124.302]];
		
					var men_trendline = svg2.selectAll(".trendline.men")
						.data(men_trend_data);
						
					men_trendline.enter()
						.append("line")
						.attr("class", "trendline men")
						.attr("x1", function(d) { return xScale(d[0]); })
						.attr("y1", function(d) { return yScale(d[1]); })
						.attr("x2", function(d) { return xScale(d[2]); })
						.attr("y2", function(d) { return yScale(d[3]); })
						.attr("stroke", "black")
						.attr("stroke-width", 1);

					// Define men line generator
					var line = d3.line()
						.x(function(d) { return xScale(d.year); })
						.y(function(d) { return yScale(d.time); });
					
					svg2.append("path")
						.datum(dataset.filter(d => d.sex === 'men'))
						.attr("class", "line men")
						.attr("d", line);
						
					//Create X axis
					svg2.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(0," + (h - padding) + ")")
						.call(xAxis);
					
					//Create Y axis
					svg2.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(" + padding + ",0)")
						.call(yAxis);
				});

				d3.selectAll(".run.chart-input")
					.on("click", function () {
						var paragraphID = d3.select(this).attr("id");
						let women_dataset, men_dataset, women_trendline, men_trendline;
						switch (paragraphID) {
							case 'women':
								women_dataset = dataset.filter(d => d.sex === 'women');
								men_dataset = [];
								women_trendline = [[1966,179.11,2017,131.4]];
								men_trendline = [[1897,0,2017,0]];
								break;
							case 'men':
								women_dataset = [];
								men_dataset = dataset.filter(d => d.sex === 'men');
								women_trendline = [[1966,0,2017,0]];
								men_trendline = [[1897,159.15,2017,124.302]];
								break;
							default:
								women_dataset = dataset.filter(d => d.sex === 'women');
								men_dataset = dataset.filter(d => d.sex === 'men');
								women_trendline = [[1966,179.11,2017,131.4]];
								men_trendline = [[1897,159.15,2017,124.302]];
								break;
						}

						var line = d3.line()
							.x(function(d) { return xScale(d.year); })
							.y(function(d) { return yScale(d.time); });

						var women = svg2.selectAll("circle")
							.data(women_dataset);

						var men = svg2.selectAll("rect")
							.data(men_dataset);

						svg2.selectAll(".line.women")
							.datum(women_dataset)
							.transition()
							.duration(500)
							.attr("class", "line women")
							.attr("d", line);
						
						svg2.selectAll(".line.men")
							.datum(men_dataset)
							.transition()
							.duration(500)
							.attr("class", "line men")
							.attr("d", line);


						svg2.selectAll(".trendline.women")
							.data(women_trendline)
							.transition()
							.duration(500)
							.attr("x1", function(d) { return xScale(d[0]); })
							.attr("y1", function(d) { return yScale(d[1]); })
							.attr("x2", function(d) { return xScale(d[2]); })
							.attr("y2", function(d) { return yScale(d[3]); })
							.attr("stroke", "black")
							.attr("stroke-width", 1);

						svg2.selectAll(".trendline.men")
							.data(men_trendline)
							.transition()
							.duration(500)
							.attr("x1", function(d) { return xScale(d[0]); })
							.attr("y1", function(d) { return yScale(d[1]); })
							.attr("x2", function(d) { return xScale(d[2]); })
							.attr("y2", function(d) { return yScale(d[3]); })
							.attr("stroke", "black")
							.attr("stroke-width", 1);
						
						women.enter()
							.append("circle")
							.attr("cx", d => xScale(d.year))
							.attr("cy", h - padding)
							.attr("r", 2)
							.attr("fill", "rgba(0, 0, 0, 0)")
							.attr("stroke", "grey")
							.attr("stroke-width", "0.5")
							.merge(women)
							.transition()
							.duration(500)
							.attr("cx", function(d) {
									return xScale(d.year);
							})
							.attr("cy", function(d) {
									return yScale(d.time);
							})
							.attr("r", 2)
							.attr("fill", "rgba(0, 0, 0, 0)")
							.attr("stroke", "red")
							.attr("stroke-width", "0.5");
						
						women
							.append("title")
							.text(d => `Time: ${d.time}, Year: ${d.year}`);

						men.enter()
							.append("rect")
							.attr("x", d => xScale(d.year))
							.attr("y", h - padding)
							.attr("width", 4)
							.attr("height", 4)
							.attr("fill", "rgba(0, 0, 0, 0)")
							.attr("stroke", "black")
							.attr("stroke-width", "0.5")
							.merge(men)
							.transition()
							.duration(500)
							.attr("x", function(d) {
									return xScale(d.year) - 2;
							})
							.attr("y", function(d) {
									return yScale(d.time) - 2;
							})
							.attr("width", 4)
							.attr("height", 4)
							.attr("fill", "rgba(0, 0, 0, 0)")
							.attr("stroke", "blue")
							.attr("stroke-width", "0.5");
						
						men
							.append("title")
							.text(d => `Time: ${d.time}, Year: ${d.year}`);

						women.exit()
							.transition()
							.duration(500)
							.attr("cy", h - padding)
							.remove();

						men.exit()
							.transition()
							.duration(500)
							.attr("y", h - padding)
							.remove();

						//Update X axis
						svg2.select(".x.axis")
							.transition()
							.duration(1000)
							.call(xAxis);

						//Update Y axis
						svg2.select(".y.axis")
							.transition()
							.duration(1000)
							.call(yAxis);
					});

				// returns slope, intercept and r-square of the line
				function leastSquares(xSeries, ySeries) {
					var reduceSumFunc = function(prev, cur) { return prev + cur; };
					
					var xBar = xSeries.reduce(reduceSumFunc) * 1.0 / xSeries.length;
					var yBar = ySeries.reduce(reduceSumFunc) * 1.0 / ySeries.length;

					var ssXX = xSeries.map(function(d) { return Math.pow(d - xBar, 2); })
						.reduce(reduceSumFunc);
					
					var ssYY = ySeries.map(function(d) { return Math.pow(d - yBar, 2); })
						.reduce(reduceSumFunc);
						
					var ssXY = xSeries.map(function(d, i) { return (d - xBar) * (ySeries[i] - yBar); })
						.reduce(reduceSumFunc);
						
					var slope = ssXY / ssXX;
					var intercept = yBar - (xBar * slope);
					var rSquare = Math.pow(ssXY, 2) / (ssXX * ssYY);
					
					return [slope, intercept, rSquare];
				}

			</script>
			<p> Winning times (in minutes) for an annual marathon event, separately for men and women. Also shown arethe straight-line and smooth-curve approximations.
				All approximations are based entirely on data points prior to 1990.</p>

			<p>Red indicates women</p>
			<p>Blue indicates men</p>

			<p>—–</p>
			<p>Data from:&nbsp;
				<a href="https://en.wikipedia.org/wiki/List_of_winners_of_the_Boston_Marathon">https://en.wikipedia.org/wiki/List_of_winners_of_the_Boston_Marathon</a>
			</p>
		</div>

	</div>
</body>

</html>
